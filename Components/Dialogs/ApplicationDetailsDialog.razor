@using ApplicationTracker.Models
@using ApplicationTracker.Utilities.Enums

<MudDialog>
	<TitleContent>
		<MudText Typo="Typo.h6">
			<MudIcon Icon="@Icons.Material.Filled.Work" Class="mr-2"/>@Application.CompanyName
		</MudText>
	</TitleContent>
	<DialogContent>
		<MudStack Spacing="3">
			<MudField Label="Status" Variant="Variant.Outlined">
				<MudStack Row Spacing="2" AlignItems="AlignItems.Center">
					<MudText>@Application.Status.ToString()</MudText>
					@if (Application.Status != ApplicationStatus.Rejected
					     && Application.Status != ApplicationStatus.Offered
					     && Application.Status != ApplicationStatus.Withdrawn) {
						<MudSpacer/>
						<MudIconButton Icon="@Icons.Material.Filled.Check"
						               Size="@Size.Small"
						               Variant="@Variant.Filled"
						               Color="@Color.Success"
						               OnClick="@(() => MudDialog.Close(DialogResult.Ok(DialogAction.NextStep)))"
						               Title="Move to next step"/>
						<MudIconButton Icon="@Icons.Material.Filled.Close"
						               Size="@Size.Small"
						               Variant="@Variant.Filled"
						               Color="@Color.Error"
						               OnClick="@(() => MudDialog.Close(DialogResult.Ok(DialogAction.Reject)))"
						               Title="Reject"/>
					}
				</MudStack>
			</MudField>

			<MudField Label="Date Applied" Variant="Variant.Outlined">
				@Application.AppliedDate.ToString("MM-dd-yyyy")
			</MudField>

			@if (!string.IsNullOrEmpty(Application.PostingURL)) {
				<MudField Label="Job Posting" Variant="Variant.Outlined">
					<MudLink Href="@Application.PostingURL" Target="_blank" Color="Color.Primary">
						<MudIcon Icon="@Icons.Material.Filled.OpenInBrowser" Size="Size.Small" Class="mr-1"/>
						Open Link
					</MudLink>
				</MudField>
			}

			@if (!string.IsNullOrEmpty(Application.Notes)) {
				<MudField Label="Notes" Variant="Variant.Outlined">
					<MudText Style="white-space: pre-wrap;">@Application.Notes</MudText>
				</MudField>
			}
		</MudStack>
	</DialogContent>
	<DialogActions>
		<MudButton OnClick="@(() => MudDialog.Close(DialogResult.Ok(DialogAction.Delete)))"
		           Color="Color.Error"
		           Variant="Variant.Text"
		           StartIcon="@Icons.Material.Filled.Delete">
			Delete
		</MudButton>
		<MudSpacer/>
		<MudButton OnClick="@(() => MudDialog.Cancel())" Color="Color.Default">
			Close
		</MudButton>
		<MudButton OnClick="@(() => MudDialog.Close(DialogResult.Ok(DialogAction.Edit)))"
		           Color="Color.Primary"
		           Variant="Variant.Filled"
		           StartIcon="@Icons.Material.Filled.Edit">
			Edit
		</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[CascadingParameter]
	private IMudDialogInstance MudDialog { get; set; } = null!;

	[Parameter]
	public ApplicationRecord Application { get; set; } = null!;

	public enum DialogAction {
		Edit,
		Delete,
		NextStep,
		Reject
	}
}
