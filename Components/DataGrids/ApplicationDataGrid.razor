@using ApplicationTracker.Models
@using ApplicationTracker.Utilities.Enums

@*Mobile DataGrid*@
<MudHidden Breakpoint="Breakpoint.SmAndDown" Invert="true">
	<MudDataGrid @ref="_applicationGrid" T="ApplicationRecord" Items="@_applicationRecords"
	             SortMode="SortMode.Multiple" Filterable="true" ReadOnly="true"
	             Bordered="true" QuickFilter="@QuickFilter"
	             Breakpoint="Breakpoint.None"
	             RowClick="@OnRowClick" Hover="true" >
		<ToolBarContent>
			<MudTextField @bind-Value="_searchString" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
			              AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0">
			</MudTextField>
			<MudSpacer/>
			<MudIconButton Icon="@Icons.Material.Filled.AddBox" OnClick="@MobileNewRecordAsync" Disabled="IsLoading"/>
		</ToolBarContent>
		<Columns>
			<PropertyColumn Property="x => x.CompanyName" Title="Company" Filterable="true" Sortable="true"
			                SortBy="@(x => $"{x.CompanyName}")"/>
		</Columns>
		<PagerContent>
			<MudDataGridPager T="ApplicationRecord"/>
		</PagerContent>
	</MudDataGrid>
</MudHidden>

@*Desktop DataGrid*@
<MudHidden Breakpoint="Breakpoint.MdAndUp" Invert="true">
	<MudDataGrid @ref="_applicationGrid" T="ApplicationRecord" Items="@_applicationRecords"
	             SortMode="SortMode.Multiple" Filterable="true" ReadOnly="false"
	             Hideable="true" Bordered="true" EditMode="DataGridEditMode.Form" QuickFilter="@QuickFilter"
	             CommittedItemChanges="@CommittedItemChangesAsync">
		<ToolBarContent>
			<MudText Typo="Typo.h6">Applications</MudText>
			<MudSpacer/>
			<MudTextField @bind-Value="_searchString" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
			              AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0">
			</MudTextField>
			<MudSpacer/>
			<MudButtonGroup Class="ma-0 pa-0" Color="Color.Success" Variant="Variant.Filled">
				<MudButton OnClick="@NewRecordAsync" Disabled="IsLoading">
					Add New Record
				</MudButton>
			</MudButtonGroup>
		</ToolBarContent>
		<Columns>
			<PropertyColumn Property="x => x.CompanyName" Title="Company Name"/>
			<TemplateColumn Title="Date Applied" Editable="true" Filterable="true" Sortable="true"
			                SortBy="@(x => $"{x.AppliedDate}")"
			                HeaderStyle="width: 15%;"
			                CellStyle="width: 15%;">
				<CellTemplate>
					<MudDatePicker @bind-Date="context.Item.AppliedDate" Label="Date Applied"
					               Variant="Variant.Outlined" DateFormat="MM/dd/yyyy" ReadOnly="true" />
				</CellTemplate>
				<EditTemplate>
					<MudDatePicker @bind-Date="context.Item.AppliedDate" Label="Date Applied"
					               Variant="Variant.Outlined" DateFormat="MM/dd/yyyy"/>
				</EditTemplate>
			</TemplateColumn>
			<TemplateColumn Title="Status" Editable="true" Filterable="true" Sortable="true"
			                SortBy="@(x => $"{x.Status}")"
			                HeaderStyle="width: 15%;"
			                CellStyle="width: 15%;">
				<CellTemplate>
					<MudStack Row Spacing="2" AlignItems="AlignItems.Center">
						<MudText Typo="Typo.body1" Style="min-width: 100px;">
							@context.Item.Status.ToString()
						</MudText>
						@if (context.Item.Status != ApplicationStatus.Rejected
						     && context.Item.Status != ApplicationStatus.Offered
						     && context.Item.Status != ApplicationStatus.Withdrawn)
						{
							<MudDivider Vertical="true" FlexItem="true"/>
							<MudIconButton Icon="@Icons.Material.Filled.Check"
							               Size="@Size.Small"
							               Variant="@Variant.Filled"
							               Color="@Color.Success"
							               OnClick="@(() => NextStep(context.Item))"/>
							<MudIconButton Icon="@Icons.Material.Filled.Close"
							               Size="@Size.Small"
							               Variant="@Variant.Filled"
							               Color="@Color.Error"
							               OnClick="@(() => Reject(context.Item))"/>
						}
					</MudStack>
				</CellTemplate>
				<EditTemplate>
					<MudSelect @bind-Value="context.Item.Status" RequiredError="Must select a status" Required="true"
					           Variant="Variant.Outlined">
						@foreach (ApplicationStatus status in Enum.GetValues(typeof(ApplicationStatus)))
						{
							<MudSelectItem Value="status">@status.ToString()</MudSelectItem>
						}
					</MudSelect>
				</EditTemplate>
			</TemplateColumn>
			<TemplateColumn Title="Link" Sortable="false" Filterable="false"
			                HeaderStyle="width: 5%; text-align: center;"
			                CellStyle="width: 5%; text-align: center;">
				<CellTemplate>
					<MudIconButton Icon="@Icons.Material.Filled.OpenInBrowser"
					               Size="Size.Medium"
					               Href="@context.Item.PostingURL"
					               Target="_blank"
					               Disabled="@(string.IsNullOrEmpty(context.Item.PostingURL))"
					               Color="Color.Primary"/>
				</CellTemplate>
				<EditTemplate>
					<MudTextField @bind-Value="context.Item.PostingURL"
					              Label="Job Posting URL"
					              Variant="Variant.Outlined"
					              InputType="InputType.Url"
					              Validation="@(new Func<string, string>(ValidateUrl))"
					              Immediate="true"
					              Placeholder="https://example.com/job"
					              HelperText="Enter the URL to the job posting"
					              Adornment="Adornment.Start"
					              AdornmentIcon="@Icons.Material.Filled.Link"/>
				</EditTemplate>
			</TemplateColumn>

			<TemplateColumn Title="Notes" Sortable="false" Filterable="false"
			                HeaderStyle="width: 10%; text-align: center;" CellStyle="width: 10%; text-align: center;">
				<CellTemplate>
					<MudIconButton Icon="@Icons.Material.Filled.Notes"
					               Size="Size.Medium"
					               Color="@(string.IsNullOrEmpty(context.Item.Notes) ? Color.Default : Color.Info)"
					               OnClick="@(() => OpenApplicationNotesDialogAsync(context.Item))"/>
				</CellTemplate>
			</TemplateColumn>

			<TemplateColumn Editable="false"
			                HeaderStyle="width: 10%;"
			                CellStyle="width: 10%;">
				<CellTemplate>
					<MudIconButton Size="@Size.Medium" Icon="@Icons.Material.Outlined.Edit"
					               OnClick="@context.Actions.StartEditingItemAsync"/>
					<MudIconButton Size="@Size.Medium" Icon="@Icons.Material.Outlined.Delete"
					               OnClick="@(() => Delete(context.Item))"/>
				</CellTemplate>
			</TemplateColumn>
		</Columns>
		<PagerContent>
			<MudDataGridPager T="ApplicationRecord"/>
		</PagerContent>
	</MudDataGrid>
</MudHidden>
